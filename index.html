<!DOCTYPE html>
<html>
<head>
    <title>Microbe Evolution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; touch-action: none; background: #1a1a1a; }
        #gameCanvas { position: absolute; }
        .ui {
            position: fixed; padding: 10px; background: #00000055; border-radius: 5px; 
            color: white; font-family: Arial;
        }
        #stats { top: 10px; left: 10px; }
        #abilities { bottom: 10px; right: 10px; text-align: right; }
        button { background: #444; color: white; border: none; padding: 8px; margin: 2px; border-radius: 3px; }
        
        /* Меню */
        #menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: #000000aa;
            padding: 20px;
            border-radius: 10px;
        }
        .menu-btn { 
            width: 150px; 
            margin: 10px; 
            background: #334455;
        }
        #deathScreen {
            display: none;
            color: #ff4444;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="menu">
        <h1>Microbe Evolution</h1>
        <button class="menu-btn" onclick="startGame()">Новая игра</button>
        <button class="menu-btn" onclick="continueGame()" id="continueBtn">Продолжить</button>
        <div id="deathScreen">
            <h2>Вы погибли!</h2>
            <button class="menu-btn" onclick="showMenu()">В меню</button>
        </div>
    </div>

    <div id="stats" class="ui">
        <div>Health: <span id="health">100</span></div>
        <div>Energy: <span id="energy">50</span></div>
        <div>DNA: <span id="dna">0</span></div>
    </div>
    <div id="abilities" class="ui">
        <button onclick="evolve('speed')">Speed+ (10 DNA)</button>
        <button onclick="evolve('health')">Health+ (15 DNA)</button>
        <button onclick="evolve('vision')">Vision+ (20 DNA)</button>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WORLD_SIZE = 2000;
let cameraX = 0, cameraY = 0;
let gameState = 'menu'; // 'menu', 'playing', 'dead'

// Настройки
const FLOCK_SETTINGS = { /* ... */ };
const REPRODUCTION_SETTINGS = { /* ... */ };

// Инициализация элементов интерфейса
const menu = document.getElementById('menu');
const deathScreen = document.getElementById('deathScreen');
const continueBtn = document.getElementById('continueBtn');

function resizeCanvas() { /* ... */ }
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let player = {};
let world = {};

function initGame() {
    player = {
        x: WORLD_SIZE/2, y: WORLD_SIZE/2, size: 20,
        speed: 2, health: 100, energy: 50, dna: 0,
        vision: 200, direction: 0
    };

    world = {
        resources: [],
        creatures: [],
        particles: []
    };
}

function createCreature(type, x, y) {
    const base = { /* ... */ };
    
    switch(type) {
        case 'predator':
            return {...base, 
                color: '#ff4444', 
                speed: 1.8, // Уменьшенная скорость
                attack: 5,
                vision: 300
            };
        /* ... */
    }
}

function generateWorld() { /* ... */ }

function update() {
    if(gameState !== 'playing') return;
    
    if(player.health <= 0) {
        gameState = 'dead';
        deathScreen.style.display = 'block';
        menu.style.display = 'block';
        localStorage.removeItem('gameState');
        return;
    }

    // Остальная логика обновления...
}

function draw() { /* ... */ }

// Управление меню
function showMenu() {
    gameState = 'menu';
    menu.style.display = 'block';
    deathScreen.style.display = 'none';
    continueBtn.disabled = !localStorage.getItem('gameState');
}

function startGame() {
    initGame();
    generateWorld();
    gameState = 'playing';
    menu.style.display = 'none';
    update();
}

function continueGame() {
    const savedState = localStorage.getItem('gameState');
    if(savedState) {
        const state = JSON.parse(savedState);
        player = state.player;
        world = state.world;
        gameState = 'playing';
        menu.style.display = 'none';
        update();
    }
}

// Инициализация
initGame();
showMenu();
window.Telegram.WebApp.ready();

// Сохранение
setInterval(() => {
    if(gameState === 'playing') {
        localStorage.setItem('gameState', JSON.stringify({
            player,
            world
        }));
    }
}, 5000);

// Остальные функции...
</script>
</body>
</html>