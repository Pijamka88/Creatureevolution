<!DOCTYPE html>
<html>
<head>
    <title>Microbe Evolution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            touch-action: none;
            background: #1a1a1a;
            color: white;
            font-family: Arial;
        }
        #gameCanvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .ui {
            position: fixed;
            padding: 10px;
            background: #00000055;
            border-radius: 5px;
        }
        #stats {
            top: 10px;
            left: 10px;
        }
        #abilities {
            bottom: 10px;
            right: 10px;
            text-align: right;
        }
        button {
            background: #444;
            color: white;
            border: none;
            padding: 8px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="stats" class="ui">
        <div>Health: <span id="health">100</span></div>
        <div>Energy: <span id="energy">50</span></div>
        <div>DNA: <span id="dna">0</span></div>
    </div>
    <div id="abilities" class="ui">
        <button onclick="evolve('speed')">Speed+ (10 DNA)</button>
        <button onclick="evolve('health')">Health+ (15 DNA)</button>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Setup canvas size
function resizeCanvas() {
    canvas.width = Math.min(window.innerWidth, 600);
    canvas.height = Math.min(window.innerHeight, 800);
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// Game state
const player = {
    x: 300,
    y: 300,
    size: 20,
    speed: 2,
    health: 100,
    energy: 50,
    dna: 0
};

const world = {
    resources: [],
    enemies: []
};

// Generate initial world
function generateWorld() {
    world.resources = [];
    for(let i = 0; i < 20; i++) {
        world.resources.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            type: Math.random() > 0.2 ? 'food' : 'dna',
            value: 10
        });
    }
}

// Game loop
function update() {
    // Movement
    const speed = player.speed * (player.energy > 0 ? 1 : 0.5);
    if (targetX !== null && targetY !== null) {
        const dx = targetX - player.x;
        const dy = targetY - player.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        
        if(dist > speed) {
            player.x += (dx/dist)*speed;
            player.y += (dy/dist)*speed;
            player.energy = Math.max(0, player.energy - 0.1);
        }
    }

    // Resource collection
    world.resources = world.resources.filter(resource => {
        const dx = resource.x - player.x;
        const dy = resource.y - player.y;
        if(Math.sqrt(dx*dx + dy*dy) < player.size) {
            if(resource.type === 'food') {
                player.health = Math.min(100, player.health + 5);
            } else {
                player.dna += 1;
            }
            return false;
        }
        return true;
    });

    // Update UI
    document.getElementById('health').textContent = Math.round(player.health);
    document.getElementById('energy').textContent = Math.round(player.energy);
    document.getElementById('dna').textContent = player.dna;

    requestAnimationFrame(update);
    draw();
}

// Drawing
function draw() {
    ctx.fillStyle = '#1a1a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw resources
    world.resources.forEach(resource => {
        ctx.fillStyle = resource.type === 'food' ? '#00ff00' : '#00ffff';
        ctx.beginPath();
        ctx.arc(resource.x, resource.y, 5, 0, Math.PI*2);
        ctx.fill();
    });

    // Draw player
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
    ctx.fill();
}

// Input handling
let targetX = null;
let targetY = null;

canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    targetX = e.clientX - rect.left;
    targetY = e.clientY - rect.top;
});

canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    targetX = e.touches[0].clientX - rect.left;
    targetY = e.touches[0].clientY - rect.top;
});

// Evolution system
function evolve(type) {
    if(player.dna < 10) return;
    
    switch(type) {
        case 'speed':
            if(player.dna >= 10) {
                player.speed += 0.5;
                player.dna -= 10;
            }
            break;
        case 'health':
            if(player.dna >= 15) {
                player.health += 20;
                player.dna -= 15;
            }
            break;
    }
}

// Start game
generateWorld();
update();

// Telegram Web Apps integration
window.Telegram.WebApp.ready();
</script>
</body>
</html>