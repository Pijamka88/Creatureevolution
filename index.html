<!DOCTYPE html>
<html>
<head>
    <title>Microbe Evolution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; touch-action: none; background: #0a0a1a; }
        #gameCanvas { position: absolute; }
        .ui {
            position: fixed; padding: 15px; background: #00000066; border-radius: 10px; 
            color: white; font-family: 'Arial', sans-serif; backdrop-filter: blur(5px);
        }
        #stats { top: 20px; left: 20px; }
        #abilities { bottom: 20px; right: 20px; text-align: right; }
        button { 
            background: #2a2a4a; color: white; border: none; padding: 10px 15px; 
            margin: 5px; border-radius: 5px; cursor: pointer; transition: background 0.2s;
        }
        button:hover { background: #3a3a5a; }
        #menu {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; background: #000000cc; padding: 30px; border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .title { font-size: 2.5em; margin-bottom: 20px; }
        .menu-button { width: 200px; font-size: 1.2em; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="menu">
        <div class="title">Microbe Evolution</div>
        <button class="menu-button" onclick="startGame()">Start Game</button>
        <button class="menu-button" onclick="showInstructions()">How to Play</button>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div id="stats" class="ui hidden">
        <div>Health: <span id="health">100</span></div>
        <div>Energy: <span id="energy">50</span></div>
        <div>DNA: <span id="dna">0</span></div>
    </div>
    <div id="abilities" class="ui hidden">
        <button onclick="evolve('speed')">Speed+ (10 DNA)</button>
        <button onclick="evolve('health')">Health+ (15 DNA)</button>
        <button onclick="evolve('vision')">Vision+ (20 DNA)</button>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WORLD_SIZE = 3000;
let cameraX = 0, cameraY = 0;
let gameActive = false;

// Setup canvas
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const player = {
    x: WORLD_SIZE/2, y: WORLD_SIZE/2, size: 20,
    speed: 2, health: 100, energy: 50, dna: 0,
    vision: 200, direction: 0
};

const world = {
    resources: [],
    creatures: [],
    particles: [],
    groups: {}
};

function createCreature(type, x, y) {
    const base = {
        x, y, size: 15, health: 100,
        direction: 0, speed: 1.5,
        attack: 0, lastAttack: 0,
        group: null
    };
    
    switch(type) {
        case 'predator':
            return {...base, 
                color: '#ff4444', 
                speed: 1.8,
                attack: 5,
                vision: 300,
                cooldown: 2000
            };
        case 'herbivore':
            const group = Math.floor(Math.random() * 3);
            return {...base,
                color: '#44ff44',
                speed: 1.8,
                flee: true,
                group
            };
        case 'parasite':
            return {...base,
                color: '#aa44ff',
                size: 10,
                speed: 1.7,
                drain: 2
            };
    }
}

function generateWorld() {
    // Resources
    for(let i = 0; i < 200; i++) {
        world.resources.push({
            x: Math.random() * WORLD_SIZE,
            y: Math.random() * WORLD_SIZE,
            type: Math.random() > 0.2 ? 'food' : 'dna',
            value: 10
        });
    }
    
    // Creatures
    for(let i = 0; i < 50; i++) {
        const type = ['predator', 'herbivore', 'parasite'][Math.floor(Math.random()*3)];
        const creature = createCreature(type, 
            Math.random() * WORLD_SIZE,
            Math.random() * WORLD_SIZE
        );
        world.creatures.push(creature);
        if(creature.group !== null) {
            if(!world.groups[creature.group]) {
                world.groups[creature.group] = [];
            }
            world.groups[creature.group].push(creature);
        }
    }
}

function updateGroups() {
    Object.values(world.groups).forEach(group => {
        if(group.length > 0) {
            // Calculate center
            const center = group.reduce((acc, curr) => {
                return {x: acc.x + curr.x, y: acc.y + curr.y};
            }, {x: 0, y: 0});
            center.x /= group.length;
            center.y /= group.length;

            // Move towards center
            group.forEach(creature => {
                const angle = Math.atan2(center.y - creature.y, center.x - creature.x);
                creature.direction = angle;
                creature.x += Math.cos(angle) * creature.speed * 0.3;
                creature.y += Math.sin(angle) * creature.speed * 0.3;
            });
        }
    });
}

function updateCreatures() {
    world.creatures.forEach(creature => {
        // Movement logic
        let target = null;
        if(creature.attack) { // Predator
            const dx = player.x - creature.x;
            const dy = player.y - creature.y;
            if(Math.sqrt(dx*dx + dy*dy) < creature.vision) {
                target = player;
            }
        } else if(creature.flee) { // Herbivore
            world.creatures.forEach(c => {
                if(c.attack && distance(c, creature) < 200) {
                    target = c;
                }
            });
        } else if(creature.drain) { // Parasite
            const closest = world.creatures.concat([player])
                .reduce((closest, curr) => 
                    distance(curr, creature) < distance(closest, creature) ? curr : closest);
            if(distance(closest, creature) < 500) target = closest;
        }

        // Move
        if(target) {
            const angle = Math.atan2(target.y - creature.y, target.x - creature.x);
            creature.direction = angle;
            if(creature.flee) {
                creature.x -= Math.cos(angle) * creature.speed;
                creature.y -= Math.sin(angle) * creature.speed;
            } else {
                if(creature.attack && distance(creature, target) < creature.size + target.size + 10) {
                    if(Date.now() - creature.lastAttack > creature.cooldown) {
                        target.health -= creature.attack;
                        creature.lastAttack = Date.now();
                        createParticles(target.x, target.y, 10, '#ff0000');
                        // Move away after attack
                        creature.x -= Math.cos(angle) * 30;
                        creature.y -= Math.sin(angle) * 30;
                    }
                } else {
                    creature.x += Math.cos(angle) * creature.speed;
                    creature.y += Math.sin(angle) * creature.speed;
                }
            }
        }

        // Boundaries
        creature.x = Math.max(0, Math.min(WORLD_SIZE, creature.x));
        creature.y = Math.max(0, Math.min(WORLD_SIZE, creature.y));
    });
}

// [Rest of the code remains the same...]

function gameOver() {
    gameActive = false;
    document.getElementById('menu').classList.remove('hidden');
    document.getElementById('stats').classList.add('hidden');
    document.getElementById('abilities').classList.add('hidden');
    document.querySelector('#menu .title').textContent = 'Game Over';
}

function startGame() {
    gameActive = true;
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('stats').classList.remove('hidden');
    document.getElementById('abilities').classList.remove('hidden');
    
    // Reset game state
    player.x = WORLD_SIZE/2;
    player.y = WORLD_SIZE/2;
    player.health = 100;
    player.energy = 50;
    player.dna = 0;
    
    world.resources = [];
    world.creatures = [];
    world.particles = [];
    world.groups = {};
    
    generateWorld();
    update();
}

function showInstructions() {
    alert(`How to play:
- Move by clicking/tapping
- Collect green dots for health
- Collect blue dots for DNA
- Avoid red predators
- Use DNA to evolve
- Survive as long as possible!`);
}

// [Rest of the initialization code...]
</script>
</body>
</html>